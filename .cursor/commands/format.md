# Форматирование документа базы знаний

Приводит указанный Markdown файл к единому стандарту формата базы знаний, используя в качестве образца структуру документов "Обучение администраторов PASS24.online" и "Обучение администраторов PASS24.online - Артека".

## Когда использовать

- После создания нового документа базы знаний
- При обновлении существующего документа
- При обнаружении несоответствий формату
- После автоматической конвертации (например, из видео)

## Что делает команда

1. **Исправляет таблицы** — приводит все таблицы к стандартному формату с короткими разделителями `| --- | --- |`
2. **Удаляет лишние разделы** — убирает разделы, которых нет в стандартной структуре
3. **Структурирует документ** — приводит к стандартной структуре согласно шаблону базы знаний
4. **Сохраняет обязательные разделы** — гарантирует наличие всех обязательных разделов
5. **Форматирует метаданные** — приводит таблицу метаданных к стандартному виду

## Стандартная структура документа

Согласно образцам и шаблону базы знаний, документ должен содержать следующие разделы (в порядке следования):

1. **Заголовок H1** — название документа
2. **Метаданные документа** (обязательно) — таблица с параметрами
3. **Целевая аудитория** (обязательно)
4. **Краткое описание** (обязательно)
5. **Предварительные требования** (опционально)
6. **Основной контент** (обязательно)
7. **Часто задаваемые вопросы (FAQ)** (опционально)
8. **Типичные ошибки и их решение** (опционально) — таблица
9. **Контрольный чек-лист** (опционально)
10. **Связанные материалы** (опционально)
11. **История изменений** (обязательно) — таблица

## Формат таблиц

Все таблицы должны использовать стандартный формат:

```markdown
| Колонка 1 | Колонка 2 | Колонка 3 |
| --- | --- | --- |
| Значение 1 | Значение 2 | Значение 3 |
```

**Важно:** Разделители должны быть короткими (`| --- | --- |`), а не длинными (`| ------------------------------------------------------------------ |`).

## Автоматическое исправление таблиц

**Важно:** Перед форматированием рекомендуется исправить таблицы с длинными разделителями, которые могут вызывать ошибки при открытии файлов.

### Использование скрипта исправления

```bash
# Проверить файл на наличие проблемных таблиц
python3 scripts/fix_markdown_tables.py "путь/к/файлу.md" --dry-run

# Исправить таблицы в файле
python3 scripts/fix_markdown_tables.py "путь/к/файлу.md"

# Исправить все файлы в базе знаний
python3 scripts/fix_markdown_tables.py
```

**Подробнее:** См. `agent_docs/markdown-table-fix-guide.md`

---

## Инструкции

### Шаг 1: Указать файл для форматирования

Пользователь указывает путь к файлу, который нужно отформатировать:

- Относительный путь от корня проекта
- Абсолютный путь
- Можно указать несколько файлов через пробел

Примеры:
- `База знаний/ОС/Обучение/Новый документ.md`
- `База знаний/Тех. поддержка/Инструкции PASS24.online/Модуль Сотрудники.md`

### Шаг 2: Прочитать файл и проанализировать структуру

1. Прочитать содержимое файла
2. Определить текущую структуру документа
3. Выявить проблемы форматирования:
   - Таблицы с длинными разделителями
   - Отсутствующие обязательные разделы
   - Лишние разделы, не соответствующие стандарту
   - Неправильное форматирование

### Шаг 3: Исправить таблицы

**Рекомендуется использовать автоматический скрипт:**

```bash
python3 scripts/fix_markdown_tables.py "путь/к/файлу.md"
```

**Или исправить вручную:**

Для всех таблиц в документе:

1. Найти все таблицы (строки, начинающиеся с `|`)
2. Определить количество колонок
3. Заменить длинные разделители на короткие:
   - Было: `| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |`
   - Стало: `| --- | --- |`
4. Убедиться, что разделитель соответствует количеству колонок

**Пример исправления:**

```markdown
# Было:
| Параметр                                                   | Значение                                                                                             |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |

# Стало:
| Параметр | Значение |
| --- | --- |
```

### Шаг 4: Проверить и упорядочить разделы

1. **Проверить наличие обязательных разделов:**
   - Заголовок H1 (название)
   - Метаданные документа
   - Целевая аудитория
   - Краткое описание
   - Основной контент
   - История изменений

2. **Упорядочить разделы** согласно стандартной структуре:
   - Если раздел находится не на своем месте, переместить его
   - Сохранить порядок разделов как в образце

3. **Удалить лишние разделы:**
   - Разделы, которых нет в стандартной структуре (например, "Сегменты с временными метками")
   - Дублирующиеся разделы
   - Пустые или неинформативные разделы

4. **Добавить недостающие обязательные разделы:**
   - Если отсутствует раздел "Метаданные документа", создать его с базовыми полями
   - Если отсутствует "Целевая аудитория", добавить с плейсхолдерами
   - Если отсутствует "Краткое описание", добавить на основе содержимого
   - Если отсутствует "История изменений", создать с текущей версией

### Шаг 5: Форматировать метаданные

Таблица метаданных должна иметь стандартный формат:

```markdown
## Метаданные документа

| Параметр | Значение |
| --- | --- |
| **Версия** | 1.0 |
| **Дата создания** | [дата] |
| **Дата последнего обновления** | [дата] |
| **Автор** | [автор] |
| **Ответственный за актуальность** | [ответственный] |
| **Статус** | [статус] |
| **Тип документа** | [тип] |
| **Отдел** | [отдел] |
| **Теги** | [теги] |
```

Если метаданные отсутствуют или имеют неправильный формат, привести к стандарту.

### Шаг 6: Форматировать раздел "История изменений"

Таблица истории изменений должна иметь стандартный формат:

```markdown
## История изменений

| Версия | Дата | Автор | Изменения |
| --- | --- | --- | --- |
| 1.0 | [дата] | [автор] | [описание] |
```

### Шаг 7: Сохранить отформатированный файл

1. Сохранить все изменения в исходный файл
2. Убедиться, что файл сохранен корректно
3. Проверить, что структура соответствует стандарту

### Шаг 8: Проверить результат

После форматирования проверить:

- [ ] Все таблицы имеют короткие разделители
- [ ] Все обязательные разделы присутствуют
- [ ] Разделы упорядочены согласно стандарту
- [ ] Метаданные отформатированы правильно
- [ ] История изменений отформатирована правильно
- [ ] Лишние разделы удалены
- [ ] Документ соответствует образцу

## Примеры использования

### Пример 1: Форматирование одного файла

```bash
# Указать файл для форматирования
format База знаний/ОС/Обучение/Новый документ.md
```

### Пример 2: Форматирование нескольких файлов

```bash
# Указать несколько файлов
format "База знаний/ОС/Обучение/Документ 1.md" "База знаний/ОС/Обучение/Документ 2.md"
```

## Что НЕ делает команда

- Не изменяет содержимое разделов (только форматирование)
- Не удаляет важную информацию
- Не изменяет структуру основного контента
- Не редактирует текст внутри разделов
- Не изменяет ссылки и изображения

## Обработка ошибок

Если файл не найден:
- Сообщить пользователю об ошибке
- Предложить проверить путь к файлу

Если файл не является Markdown:
- Сообщить, что команда работает только с `.md` файлами

Если структура файла сильно отличается от стандарта:
- Привести к стандарту максимально близко
- Сохранить весь важный контент
- Сообщить пользователю о внесенных изменениях

## Важные замечания

1. **Резервная копия:** Перед форматированием рекомендуется создать резервную копию файла (команда не создает автоматически)

2. **Git:** После форматирования изменения можно закоммитить в Git

3. **Проверка:** После форматирования рекомендуется открыть файл и проверить результат

4. **Обновление README:** После форматирования документа может потребоваться обновить соответствующий README.md файл раздела

## Связанные материалы

- `agent_docs/Шаблон статьи базы знаний.md` — шаблон для создания новых документов
- `agent_docs/Инструкция по работе с базой знаний.md` — принципы и стандарты работы с базой знаний
- `agent_docs/markdown-table-fix-guide.md` — руководство по исправлению проблем с таблицами
- `scripts/fix_markdown_tables.py` — скрипт для массового исправления таблиц
- `База знаний/ОС/Обучение/Обучение администраторов PASS24.online.md` — образец формата
- `База знаний/ОС/Обучение/Обучение администраторов PASS24.online - Артека.md` — образец формата
