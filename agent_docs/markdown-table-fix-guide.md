# Руководство по исправлению проблем с таблицами Markdown

## Проблема

В базе знаний обнаружена системная проблема: многие документы содержат таблицы с **очень длинными разделителями** (сотни дефисов), что вызывает ошибку парсера Markdown в Cursor:

```
Assertion Failed: Argument is `undefined` or `null`
```

Эта ошибка не позволяет открывать файлы в редакторе.

## Причина

Парсер Markdown в Cursor (и многих других редакторах) не может корректно обработать таблицы с разделителями длиннее 50-100 символов. Это приводит к ошибке парсинга и невозможности открыть файл.

## Решение

### Автоматическое исправление

Используйте скрипт `scripts/fix_markdown_tables.py` для массового исправления всех таблиц:

```bash
# Проверить, какие файлы будут исправлены (без сохранения)
python3 scripts/fix_markdown_tables.py --dry-run

# Исправить все файлы в базе знаний
python3 scripts/fix_markdown_tables.py

# Исправить конкретный файл
python3 scripts/fix_markdown_tables.py "База знаний/ОС/Обучение/Файл.md"

# Исправить все файлы в директории
python3 scripts/fix_markdown_tables.py "База знаний/ОС"
```

### Ручное исправление

Если нужно исправить один файл вручную:

1. Откройте файл в текстовом редакторе (не в Cursor)
2. Найдите строки с длинными разделителями таблиц (например: `| ------------------------------------------------------------------ |`)
3. Замените их на короткие разделители: `| --- | --- |`

**Пример:**

```markdown
# Было:
| Параметр                                                   | Значение                                                                                             |
| ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |

# Стало:
| Параметр | Значение |
| --- | --- |
```

## Стандартный формат таблиц

Все таблицы в базе знаний должны использовать следующий формат:

```markdown
| Колонка 1 | Колонка 2 | Колонка 3 |
| --- | --- | --- |
| Значение 1 | Значение 2 | Значение 3 |
```

**Правила:**
- Разделитель должен быть коротким: `| --- | --- |`
- Количество `---` должно соответствовать количеству колонок
- Между `|` и `---` должен быть один пробел

## Профилактика

### При создании новых документов

1. **Используйте шаблон:** Всегда начинайте с `agent_docs/Шаблон статьи базы знаний.md`
2. **Используйте команду format:** После создания документа запустите команду `format` для приведения к стандарту
3. **Проверяйте таблицы:** Убедитесь, что все таблицы используют короткие разделители

### При обновлении документов

1. **Проверяйте таблицы:** После редактирования проверьте, что таблицы не изменились на длинные разделители
2. **Используйте команду format:** Запустите `format` для проверки и исправления формата

### При конвертации из других форматов

1. **Автоматическая конвертация:** После конвертации видео в Markdown (`convert-video-md`) автоматически выполняется форматирование
2. **Ручная проверка:** Если конвертация была выполнена вручную, обязательно запустите `format` или `fix_markdown_tables.py`

## Проверка файлов

### Проверка одного файла

```bash
# Проверить файл на наличие проблемных таблиц
python3 scripts/fix_markdown_tables.py "путь/к/файлу.md" --dry-run
```

### Проверка всей базы знаний

```bash
# Проверить все файлы (без сохранения изменений)
python3 scripts/fix_markdown_tables.py --dry-run
```

## Статистика проблемы

По состоянию на 2026-01-25:
- **Найдено проблемных файлов:** 125
- **Найдено проблемных таблиц:** 1330+

## Рекомендации

1. **Немедленно:** Запустите скрипт исправления для всей базы знаний
2. **Регулярно:** Проверяйте новые документы на соответствие стандарту
3. **Автоматизация:** Используйте команду `format` при создании/обновлении документов
4. **Контроль:** Добавьте проверку таблиц в процесс code review

## Связанные материалы

- `agent_docs/Шаблон статьи базы знаний.md` — шаблон для создания документов
- `.cursor/commands/format.md` — команда для форматирования документов
- `scripts/fix_markdown_tables.py` — скрипт для массового исправления
