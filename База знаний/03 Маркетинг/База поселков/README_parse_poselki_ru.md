# Инструкция по использованию скрипта parse_poselki_ru.py

## Описание

Скрипт `parse_poselki_ru.py` предназначен для детального парсинга информации о коттеджных поселках с сайта **Poselki.ru** в соответствии с инструкцией по сбору и систематизации базы коттеджных поселков РФ.

## Особенности

- Парсит главную страницу Poselki.ru
- Находит ссылки на сайты отдельных поселков (верба-парк.рф, марьина-гора.рф, zolotye-sosny.ru и др.)
- Парсит информацию с сайтов поселков для получения полных данных
- Извлекает контактную информацию, характеристики поселков
- Использует Selenium для получения телефонов с защищенных страниц
- Сохраняет данные в формате CSV согласно структуре таблицы из инструкции

## Требования

### Установка зависимостей

```bash
pip install -r requirements.txt
```

Или установите вручную:

```bash
pip install requests beautifulsoup4 lxml selenium webdriver-manager
```

### Требования к системе

- Python 3.7+
- Google Chrome (для работы Selenium)
- Интернет-соединение

## Использование

### Базовое использование

```bash
python parse_poselki_ru.py
```

Скрипт:
1. Парсит главную страницу Poselki.ru
2. Находит ссылки на поселки
3. Парсит информацию с сайтов поселков
4. Сохраняет результаты в файл `Результат парсинга информации в интернете.csv`

### Параметры командной строки

```bash
# Без Selenium (быстрее, но меньше данных о телефонах)
python parse_poselki_ru.py --no-selenium

# Указать выходной файл
python parse_poselki_ru.py --output "мой_файл.csv"

# Selenium в видимом режиме (для отладки)
python parse_poselki_ru.py --selenium-headless False
```

### Полный список параметров

- `--no-selenium` - Не использовать Selenium для получения телефонов
- `--selenium-headless` - Запуск Selenium в headless режиме (по умолчанию: True)
- `--output` - Имя выходного CSV файла (по умолчанию: "Результат парсинга информации в интернете.csv")

## Структура данных

Скрипт сохраняет данные в формате CSV с 43 полями согласно инструкции:

### Блок 1: Основная информация о поселке
- ID
- Название поселка
- Регион
- Город/Район
- Адрес
- Координаты
- Ссылка на источник

### Блок 2: Характеристики поселка
- Количество домов/участков
- Статус поселка
- Наличие ограждения
- Наличие КПП
- Количество КПП
- Наличие охраны
- Тип охраны
- Наличие интернета

### Блок 3: Контактная информация
- Тип управления
- Название УК/ТСЖ
- ФИО председателя/руководителя
- Телефон основной
- Телефон дополнительный
- Email
- Сайт поселка/УК
- Социальные сети

### Блок 4: Квалификация по CHAMP
- Challenges (Проблемы)
- Authority (Полномочия)
- Money (Бюджет)
- Priority (Приоритет)
- Оценка целевого клиента

### Блок 5-7: Статус работы, результаты, дополнительная информация

## Логирование

Все действия скрипта логируются:
- В файл `parsing_poselki_ru.log`
- В консоль (stdout)

Уровни логирования:
- `INFO` - общая информация о процессе
- `WARNING` - предупреждения (таймауты, отсутствие данных)
- `ERROR` - ошибки парсинга
- `DEBUG` - детальная информация (только при необходимости)

## Особенности работы

### Задержки между запросами

Скрипт использует случайные задержки между запросами (2-5 секунд) для:
- Соблюдения правил использования сайтов
- Избежания блокировок
- Имитации человеческого поведения

### Обработка ошибок

Скрипт обрабатывает следующие ситуации:
- Ошибки сети (таймауты, недоступность сайтов)
- Изменение структуры страниц
- Отсутствие данных
- Дубликаты записей

### Объединение с существующими данными

Скрипт автоматически:
- Читает существующий CSV файл (если есть)
- Обновляет ID для новых записей
- Объединяет новые данные с существующими
- Сохраняет все данные в один файл

### Использование Selenium

Selenium используется для:
- Получения телефонов с защищенных страниц
- Обработки динамического контента
- Клика по кнопкам "Показать телефон"

**Ограничения:**
- Максимум 60 попыток получения телефонов через Selenium за один запуск
- Требуется установленный Google Chrome
- Медленнее, чем обычные HTTP-запросы

## Примеры использования

### Пример 1: Базовый парсинг

```bash
python parse_poselki_ru.py
```

### Пример 2: Парсинг без Selenium (быстрее)

```bash
python parse_poselki_ru.py --no-selenium
```

### Пример 3: Сохранение в другой файл

```bash
python parse_poselki_ru.py --output "poselki_ru_$(date +%Y%m%d).csv"
```

## Результаты

После выполнения скрипта:

1. **CSV файл** с результатами парсинга
2. **Лог-файл** `parsing_poselki_ru.log` с информацией о процессе
3. **Консольный вывод** с краткой статистикой

### Статистика в консоли

```
Парсинг завершен. Найдено поселков: 3
Телефонов получено через Selenium: 2
Сохранено 3 новых записей в файл Результат парсинга информации в интернете.csv
Всего записей в файле: 62
```

## Устранение неполадок

### Проблема: Selenium не работает

**Решение:**
1. Убедитесь, что установлен Google Chrome
2. Установите зависимости: `pip install selenium webdriver-manager`
3. Используйте `--no-selenium` для работы без Selenium

### Проблема: Сайт недоступен

**Решение:**
1. Проверьте интернет-соединение
2. Проверьте доступность сайта poselki.ru в браузере
3. Увеличьте таймауты в коде (если необходимо)

### Проблема: Не найдены поселки

**Решение:**
1. Проверьте логи в `parsing_poselki_ru.log`
2. Убедитесь, что структура сайта не изменилась
3. Проверьте, что сайт доступен

### Проблема: Дубликаты в файле

**Решение:**
Скрипт автоматически обрабатывает дубликаты, но если они все же появляются:
1. Проверьте логи на наличие предупреждений
2. Удалите дубликаты вручную в Excel/Google Sheets
3. Проверьте, что ID записей уникальны

## Соответствие инструкции

Скрипт полностью соответствует инструкции по сбору и систематизации базы коттеджных поселков РФ:

✅ Использует все поля из структуры таблицы  
✅ Сохраняет данные в правильном формате CSV  
✅ Извлекает информацию согласно критериям отбора  
✅ Логирует все действия  
✅ Использует правильные источники информации  

## Дополнительная информация

- **Инструкция по сбору:** `Инструкция по сбору и систематизации базы коттеджных поселков РФ.md`
- **Основной скрипт парсинга:** `parse_cottage_villages.py`
- **Общая документация:** `README_parsing.md`

## Поддержка

При возникновении проблем:

1. Проверьте логи в файле `parsing_poselki_ru.log`
2. Убедитесь, что все зависимости установлены
3. Проверьте доступность интернет-соединения
4. Обратитесь к разработчику скрипта

## Важные замечания

⚠️ **Внимание:**
- Парсинг может нарушать правила использования некоторых сайтов
- Рекомендуется использовать официальные API, если они доступны
- При коммерческом использовании убедитесь в соблюдении законодательства
- Регулярно проверяйте актуальность данных
- Всегда проверяйте результаты парсинга вручную перед использованием

## Лицензия

Скрипт создан для внутреннего использования компании PASS24.online.
